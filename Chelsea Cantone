// Fire Fighting Robot Coding


//NOTE that the sensors read higher numbers when the object, or wall, are closer. (The farther, the lower number it is,) 
int ldist; // LEFT SENSOR READ
int fdist; // FRONT SENSOR READ
int rdist; // RIGHT SENSOR READ

// PIN Assignments
int switchPin = 12; // Pin for switch 
int motor1Pin1 = 4; // left backwards (white wire)
int motor1Pin2 = 5; // left forwards (brown wire)
int motor2Pin2 = 6; // right backwards (red wire) 
int motor2Pin1 = 7; // right forwards (black wire)
/*
int groundPin = 8; // connect ground sensor to pin 8
int flamePin = 9; // connect flame sensor to pin 9
int fanPin = 10; // connect fan to pin 10
*/

int led = 11;

boolean currentState = LOW;  

void setup(){ 
  pinMode(switchPin, INPUT);
  pinMode(motor1Pin2, OUTPUT);
  pinMode(motor1Pin1, OUTPUT);
  pinMode(motor2Pin2, OUTPUT);
  pinMode(motor2Pin1, OUTPUT);
  
  /*
  pinMode(groundPin, OUTPUT);
  pinMode(flamePin, OUTPUT);
  pinMode(fanPin, OUTPUT);
  */
  
  pinMode(led, OUTPUT);
  Serial.begin(9600);
  while(digitalRead(switchPin) != HIGH) 
  {
      digitalWrite(led, LOW);
  }
}
//********************************************
//Defining Robot's Potential Actions as functions
//Stop, move forward, turn left, turn right
//Call different order of functions depending on the potential
//situations in the maze (3-way fork, left only, etc.)
//********************************************

void Stop()
  {
  Serial.println("Not Moving");
  Serial.println();
  digitalWrite(motor1Pin1, LOW);
  digitalWrite(motor1Pin2, LOW);
  digitalWrite(motor2Pin1, LOW);
  digitalWrite(motor2Pin2, LOW);  
  // delay(300);
  }

void goForward()
  {
  Serial.println("Moving Forward");
  Serial.println();
  digitalWrite(motor1Pin1, LOW);
  digitalWrite(motor1Pin2, HIGH);
  digitalWrite(motor2Pin1, HIGH);
  digitalWrite(motor2Pin2, LOW);  
  // delay(300);
  }

//SUGGESTION:
//Turns 90 degrees clockwise, and continues forward
//Not exactly sure how many seconds that would take...Some delay

void turnRight()
  {
  Serial.println("Turning Right");
  Serial.println();
  digitalWrite(motor1Pin1, HIGH);
  digitalWrite(motor1Pin2, LOW);
  digitalWrite(motor2Pin1, LOW);
  digitalWrite(motor2Pin2, HIGH);  
  // delay(300); 
  Stop();
  }

//Turns 90 degrees counterclockwise, and continues forward

void turnLeft()
  {
  Serial.println("Moving Forward");
  Serial.println();
  digitalWrite(motor1Pin1, HIGH);
  digitalWrite(motor1Pin2, LOW);
  digitalWrite(motor2Pin1, LOW);
  digitalWrite(motor2Pin2, HIGH);  
  //delay(300);
  Stop();
  }


void loop() {
  currentState = digitalRead(switchPin); //What is the current state? 
  //currentState = HIGH; //This line is to test the code without the switch
  
  //TURN ON: If the SWITCH is ON, then read sensors and move motors accordingly
  if (currentState == HIGH)
  { 
    digitalWrite(led, HIGH); // light turns on

      ldist = analogRead(A1);
      fdist = analogRead(A2);
      rdist = analogRead(A3);
       
      Serial.println("Left Sensor Reads: "); 
      Serial.println(ldist);
      Serial.println("Front Sensor Reads: ");
      Serial.println(fdist);
      Serial.println("Right Sensor Reads: ");
      Serial.println(rdist);

      // README:
      // 1) Turning right is prioritized.
      //    If the robot cannot turn right, it will go straight.
      // 2) If there is a open space, it will turn right for 3second 
      //
      //

      int ttime = 300; //turning right time. Assuming 3s will make it turn 90 
      int tbtime = 600; //turning back time

      //DEFAULT: TURN RIGHT AND GO FORWARD
      if (rdist < 300) 
      {
          Serial.println("Right Turn");
          Serial.println();
          turnRight();
          delay (ttime); //turn right for 90 degrees
          goForward();
          delay (100); 
      }

      //GO FORWARD
      else if ((fdist < 400) && (fdist < ldist) && (fdist < rdist)) //If the distance of the front is farther than the distances of left and right,
      {                                                       			//go forward
         goForward();
      } 
  
      //TURN BACK (TURN RIGHT 180 DEGREES)
      else if (fdist == 400 && ldist == 400 && rdist == 400)
      {
        //If go right turns the bot 90 degrees clockwise, calling twice
        //will turn it 180 degrees clockwise, and it will proceed to move forward.
        Stop();
        turnRight();
        turnRight();
        goForward();
        delay(100);
      }
  
      
      //TURN LEFT
      else if (rdist > 500) 
        {
          //Right Sensor detects something less 23cm away
          // Result need to TURN Left 90 degrees and GO FORWARD
          Serial.println("Left Turn");
          Serial.println();
          turnLeft();
          goForward();
        }
        
        if (ldist > 400) 
        {
          //Left Sensor detects something less 23cm away
          // Result need to TURN Right
          turnRight();
          goForward();        
        }

        delay(3000); //After reading from sensors, wait 3.000 seconds
    }

    //TURN OFF  the motors if the SWITCH is OFF
    else if(currentState == LOW)
    { 
      Serial.println("OFF");
      Stop();
      digitalWrite(led, LOW); // ADDED NOW  
  }
 
}


